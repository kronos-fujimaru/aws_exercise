# AWS総合演習

6月のチーム開発演習で作成したWebアプリケーション（CodeTrain）をAWSにデプロイしてください。
RDSなど、一部のサービスはチーム内で共有するものの、各自でデプロイをしていきます。
チーム内で相談、協力しながら進めてください。

<br>

## 前提条件

- VPC
    - 各チームのVPCとサブネットを使用する
- RDS
    - 各チーム毎に1つのRDSを使用する

<br>

## 演習

### 演習1

チームで1つのVPCを作成してください。VPCの仕様は以下のとおりとします。

<table>
    <tr>
        <th>名前のタグ</th>
        <td>任意</td>
    </tr>
    <tr>
        <th>アベイラビリティゾーンの数</th>
        <td>2</td>
    </tr>
    <tr>
        <th>アベイラビリティーゾーン</th>
        <td>a と c を作成する<br>※「AZのカスタマイズ」から指定可</td>
    </tr>
    <tr>
        <th>パブリックサブネットの数</th>
        <td>2</td>
    </tr>
    <tr>
        <th>プライベートサブネットの数</th>
        <td>2</td>
    </tr>
</table>

<br>

### 演習2

チームで1つのRDSを作成してください。作成後、コマンドプロンプトやMySQL Workbenchで接続し、テーブルや初期データを作成しましょう。RDSの仕様は以下のとおりとします。

<table>
    <tr>
        <th>エンジン</th>
        <td>MySQL 8.0</td>
    </tr>
    <tr>
        <th>テンプレート</th>
        <td>無料利用枠</td>
    </tr>
    <tr>
        <th>DBインスタンス識別子</th>
        <td>任意</td>
    </tr>
    <tr>
        <th>認証情報の設定</th>
        <td>マスターユーザー名とマスターパスワードは任意</td>
    </tr>
    <tr>
        <th>VPC</th>
        <td>チームのVPC</td>
    </tr>
    <tr>
        <th>アベイラビリティーゾーン</th>
        <td>ap-northeast-1a または ap-northeast-2a</td>
    </tr>
    <tr>
        <th>大文字小文字</th>
        <td>区別しない</td>
    </tr>
</table>

<br>

### 演習3

データの管理をローカルのDBからRDSに移行してください。移行後、ローカル上でWebアプリケーションが正常に動作することを確認しましょう。

<br>

### 演習4

EC2インスタンスを立て、JDK、APサーバー、Webサーバーを構築し、eラーニングシステム（CodeTrain）をデプロイしてください。デプロイ後、Webアプリケーションが正常に動作することを確認してください。また、EC2インスタンスを停止 → 開始してWebアプリケーションにアクセスできることを確認してください。EC2インスタンスの仕様は以下のとおりとします。

<table>
    <tr>
        <th>インスタンス名</th>
        <td>任意<br>※先頭または末尾に自身の番号は含めること</td>
    </tr>
    <tr>
        <th>AMI</th>
        <td>Amazon Linux 2 AMI</td>
    </tr>
    <tr>
        <th>インスタンスタイプ</th>
        <td>t2.micro</td>
    </tr>
    <tr>
        <th>キーペア</th>
        <td>ED25519で新規作成</td>
    </tr>
    <tr>
        <th>セキュリティグループ</th>
        <td>新規作成</td>
    </tr>
    <tr>
        <th>ストレージ</th>
        <td>適切なボリュームを設定</td>
    </tr>
</table>

<br>

### 演習5

起動したEC2インスタンスに対してElastic IPを割り当ててIPアドレスを固定してください。EC2インスタンスを停止 → 開始してもIPアドレスが変わらず、Webアプリケーションにアクセスできることを確認してしましょう。確認後、Elastic IPの割り当てを解除してください。

> Elastic IPの割り当て数には制限があるため、各チームで順番に取り組んでください。

<br>

### 演習6

起動したEC2インスタンスのAMI（マイAMI）を作成してください。AMIの仕様は以下のとおりとします。

<table>
    <tr>
        <th>イメージ名</th>
        <td>任意<br>※先頭または末尾に自身の番号は含めること</td>
    </tr>
    <tr>
        <th>イメージの説明</th>
        <td>適切な説明</td>
    </tr>
    <tr>
        <th>ボリューム</th>
        <td>任意</td>
    </tr>
</table>

<br>

作成したAMIでEC2インスタンスを起動し、同様のWebアプリケーションにアクセスできることを確認してください。

<br>

### 演習7

ロードバランサー（ALB）を作成し、2つのEC2インスタンスに負荷分散する構成を構築してください。構築後、正常にWebアプリケーションへアクセスできること、データを更新しても整合性が保たれることを確認しましょう。また、各EC2インスタンスに直接アクセスできないようにしてください。

<br>

### 演習8

ロゴなどの画像をS3のバケットに格納し、Webアプリケーションの各ページはS3上の画像を参照するように修正してください。Webアプリケーションの各ページの画像が正常に表示されること、S3上の画像を上書きすると各ページに反映されることを確認しましょう。

修正後、EC2インスタンスにデプロイし直して、同じく正常に表示されることを確認してください。

<br><br>

## 追加仕様

各チームで必要な追加仕様を検討し、AWS上に構築してみましょう。

例）

- システムエラーページ（HTML）をS3上に公開し、Webアプリケーションから参照する。
- S3にファイルアップロードをし、S3上のファイルを参照する。
- 請求額計算機能をLambda関数化し、月末に定期実行させる。
- ロードバランサー（ALB）をパブリックサブネット、EC2インスタンスとRDSをプライベートサブネットに構築し直す。

<br><br>